<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Spotify Callback</title>
    {% load static %}
</head>
<body>
    <div id="user-data"></div>

    <script>
        try {
            const userDataJson = '{{ user_data_json|escapejs }}';

            if (!userDataJson || userDataJson.trim() === '') {
                throw new Error("Kullanıcı verisi alınamadı!");
            }

            const userData = JSON.parse(userDataJson);

            if (userData.access_token) {
                localStorage.setItem('spotify_user_data', JSON.stringify(userData));
                console.log("Access token kaydedildi:", userData.access_token);
                window.location.href = "{% url 'spotify_home' %}";
            } else {
                throw new Error("Access token bulunamadı!");
            }
        } catch (error) {
            console.error("Giriş sırasında hata oluştu:", error);
            document.getElementById("user-data").textContent = "Hata: " + error.message;
            alert("Giriş sırasında bir hata oluştu. Lütfen tekrar deneyin.");
        }
    </script>
</body>
</html>